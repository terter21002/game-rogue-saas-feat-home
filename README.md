# GAME ROGUE SAAS

This project uses `pnpm@9.0.4` for package manager `nodejs@18.20.1` for engine

You should install this by running this command before run the project

```sh
npm install -g pnpm@9.0.4
```

Run the following command:

```sh
npm install -g turbo
pnpm install
pnpm dev
```

or you can run the project by docker

```sh
docker compose up -d
```

Then you can browse the example apps on [web:localhost](http://localhost:3000) and [api:localhost](http://localhost:8000)

## Tips for development

### How to install dependencies

This command will install module typescript as dev dependencies for `api` app or `@repo/ui` package

```sh
pnpm add typescript --save-dev --filter=api
```

```sh
pnpm add typescript --save-dev --filter=@repo/ui
```

### How to install internal modules

This command will install package `@repo/utils` for `api` app

```sh
pnpm add @repo/utils@workspace:^ --save-dev --filter=api
```

### IMPORTANT!! Please check eslint before commit

This repository includes husky for checking formatting

But you should check lint before commit your changes

```sh
pnpm lint -- --fix
```

## What kind of this project?

This project is monorepo powered by [Turborepo](http://turbo.build) including apps and packages

They share config files for typescript, eslint, tailwindcss

## What's inside?

This Turborepo includes the following packages/apps:

### Apps and Packages

- `web (apps/web)`: a [Next.js](https://nextjs.org/) app with [Tailwind CSS](https://tailwindcss.com/) in app router
- `api (apps/api)`: Express.js application with mongodb in typescript
- `@repo/ui`: a stub React component library with [Tailwind CSS](https://tailwindcss.com/)
- `@repo/types`: an ESM module with type definition with typescript shared by whole project
- `@repo/utils`: a stub NodeJS library with Typescript shared by both `wep` and `api` applications
- `@repo/eslint-config (packages/config-eslint)`: `eslint` configurations (includes `eslint-config-next` and `eslint-config-prettier`)
- `@repo/typescript-config (packages/config-typescript)`: `tsconfig.json`s used throughout the monorepo
- `@repo/tailwind-config (packages/config-tailwind)`: `tailwind.config.ts`s used throughout the monorepo

Each package/app is 100% [TypeScript](https://www.typescriptlang.org/).

### Deployment

#### Kubernetes

This repository contains kubernetes files for deployment

- `.kubernetes/backendconfig.yaml`: Load balancer Backend configuration for network endpoints being applied to service for ingress ([What is backend service](https://cloud.google.com/load-balancing/docs/backend-service))
- `.kubernetes/web-config.yaml`: !! GENERATED BY GITHUB ACTION DYNAMICALLY!!! contains configuration environment variables
- `.kubernetes/web-deployment.yaml`: Deploy pod(s) to kubernetes cluster with workload name `web`
- `.kubernetes/web-service.yaml`: Expose deployed pod as service and configure backend service
- `.kubernetes/web-ingress.yaml`: Expose service as ingress and attach special domain (optional) to the service
- `.kubernetes/kustomization.yaml`: Kustomization configuration file to run the kubernetes files

#### Github action

Also we have github action `.github/workflows/web.yml` to run the kubernetes files with Kustomization

We need some env vars to run the workflows on github action

- `environment/production/secrets/GCP_CREDENTIALS`: service account credentials from google service used for authentication (plz don't forget to make as plain text to store. remove any \r\t)
- `environment/production/secrets/GKE_PROJECT`: project id of google cloud platform
- `environment/production/vars/GAR_LOCATION`: location config for your artifact repository (e.g. us-central1)
- `environment/production/vars/GKE_CLUSTER`: cluster id of kubernetes engine
- `environment/production/vars/GKE_LOCATION`: location config for your google kubernetes cluster (e.g. us-central1)
- `environment/production/vars/GAR_REPOSITORY`: repository name of google artifact repository you use to store your docker images built from code
- `environment/production/vars/NEXT_PUBLIC_API_URL`: this is used to set env var to build the docker image and run container (pointed on `/.env.example`)

what does this github action do?

- Checkout the repository
- Authenticate to google cloud platform by service account JSON
- Authenticate to docker and kubernetes engine
- Build the docker image and publish to artifacts repository
- Download portable kustomization file
- Generate web-config.yaml file dynamically based on env var `NEXT_PUBLIC_API_URL`
- Run kubernetes to deploy on GKE
